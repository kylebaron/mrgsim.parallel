<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulate with mrgsolve in Parallel • mrgsolve.fu</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Simulate with mrgsolve in Parallel">
<meta property="og:description" content="Simulate from a mrgsolve model using parallel backend.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">mrgsolve.fu</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mrgsolve/mrgsolve.fu">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="mrgsolveparallel" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#mrgsolveparallel" class="anchor"></a>mrgsolve.parallel</h1></div>
<!-- badges: start -->

<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>mrgsolve.fu facilitates parallel simulation with mrgsolve in R. The future and parallel packages provide the parallelization.</p>
<p>There are 2 main workflows:</p>
<ol>
<li>Split a <code>data_set</code> into chunks by ID, simulate the chunks in parallel, then assemble the results back to a single data frame.</li>
<li>Split an <code>idata_set</code> (individual-level parameters) into chunks by row, simulate the chunks in parallel, then assemble the results back to a single data frame.</li>
</ol>
<p>The nature of the parallel backend requires some overhead to get the parallel simulation done. So, it will take a reasonably-sized job to see a speed increase and small jobs will likely take <em>longer</em> with parallelization. The overhead will have less of an impact as the job gets bigger and very large jobs (taking 20 or 60 minutes … or longer) will make the overhead look negligible.</p>
</div>
<div id="backend" class="section level2">
<h2 class="hasAnchor">
<a href="#backend" class="anchor"></a>Backend</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(future)</a>
<a class="sourceLine" id="cb1-4" title="4"></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(mrgsolve.parallel)</a>
<a class="sourceLine" id="cb1-6" title="6"></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="kw"><a href="https://rdrr.io/r/base/options.html">options</a></span>(<span class="dt">future.fork.enable=</span><span class="ot">TRUE</span>, <span class="dt">mc.cores =</span> 6L)</a>
<a class="sourceLine" id="cb1-8" title="8"></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="kw"><a href="https://rdrr.io/pkg/future/man/plan.html">plan</a></span>(multiprocess,<span class="dt">workers=</span>6L)</a></code></pre></div>
</div>
<div id="first-workflow-split-and-simulate-a-data-set" class="section level2">
<h2 class="hasAnchor">
<a href="#first-workflow-split-and-simulate-a-data-set" class="anchor"></a>First workflow: split and simulate a data set</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">mod &lt;-<span class="st"> </span><span class="kw">modlib</span>(<span class="st">"pk2cmt"</span>, <span class="dt">end =</span> <span class="dv">168</span><span class="op">*</span><span class="dv">8</span>, <span class="dt">delta =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb2-2" title="2"></a>
<a class="sourceLine" id="cb2-3" title="3">data &lt;-<span class="st"> </span><span class="kw">expand.ev</span>(<span class="dt">amt =</span> <span class="dv">100</span><span class="op">*</span><span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">1</span>,<span class="dv">2000</span>), <span class="dt">ii =</span> <span class="dv">24</span>, <span class="dt">addl =</span> <span class="dv">27</span><span class="op">*</span><span class="dv">2</span><span class="op">+</span><span class="dv">2</span>) </a>
<a class="sourceLine" id="cb2-4" title="4"></a>
<a class="sourceLine" id="cb2-5" title="5">data &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(data, <span class="dt">CL =</span> <span class="kw"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org/reference/n.html">n</a></span>(), <span class="fl">0.7</span>, <span class="fl">1.3</span>))</a>
<a class="sourceLine" id="cb2-6" title="6"></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(data)</a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">.   ID time amt ii addl cmt evid       CL</a>
<a class="sourceLine" id="cb3-2" title="2">. <span class="dv">1</span>  <span class="dv">1</span>    <span class="dv">0</span> <span class="dv">100</span> <span class="dv">24</span>   <span class="dv">56</span>   <span class="dv">1</span>    <span class="dv">1</span> <span class="fl">1.138040</span></a>
<a class="sourceLine" id="cb3-3" title="3">. <span class="dv">2</span>  <span class="dv">2</span>    <span class="dv">0</span> <span class="dv">200</span> <span class="dv">24</span>   <span class="dv">56</span>   <span class="dv">1</span>    <span class="dv">1</span> <span class="fl">0.854579</span></a>
<a class="sourceLine" id="cb3-4" title="4">. <span class="dv">3</span>  <span class="dv">3</span>    <span class="dv">0</span> <span class="dv">300</span> <span class="dv">24</span>   <span class="dv">56</span>   <span class="dv">1</span>    <span class="dv">1</span> <span class="fl">1.130316</span></a>
<a class="sourceLine" id="cb3-5" title="5">. <span class="dv">4</span>  <span class="dv">4</span>    <span class="dv">0</span> <span class="dv">400</span> <span class="dv">24</span>   <span class="dv">56</span>   <span class="dv">1</span>    <span class="dv">1</span> <span class="fl">1.078820</span></a>
<a class="sourceLine" id="cb3-6" title="6">. <span class="dv">5</span>  <span class="dv">5</span>    <span class="dv">0</span> <span class="dv">500</span> <span class="dv">24</span>   <span class="dv">56</span>   <span class="dv">1</span>    <span class="dv">1</span> <span class="fl">1.025052</span></a>
<a class="sourceLine" id="cb3-7" title="7">. <span class="dv">6</span>  <span class="dv">6</span>    <span class="dv">0</span> <span class="dv">600</span> <span class="dv">24</span>   <span class="dv">56</span>   <span class="dv">1</span>    <span class="dv">1</span> <span class="fl">1.139057</span></a></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(data)</a></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">. [<span class="dv">1</span>] <span class="dv">2000</span>    <span class="dv">8</span></a></code></pre></div>
<p>We can simulate in parallel with the future package or the parallel package like this:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(ans &lt;-<span class="st"> </span><span class="kw"><a href="reference/parallel_mrgsim_d.html">future_mrgsim_d</a></span>(mod, data, <span class="dt">nchunk =</span> 6L))</a></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">.    user  system elapsed </a>
<a class="sourceLine" id="cb7-2" title="2">.  <span class="fl">13.581</span>   <span class="fl">1.328</span>   <span class="fl">3.459</span></a></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(ans &lt;-<span class="st"> </span><span class="kw"><a href="reference/parallel_mrgsim_d.html">mc_mrgsim_d</a></span>(mod, data, <span class="dt">nchunk =</span> 6L))</a></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">.    user  system elapsed </a>
<a class="sourceLine" id="cb9-2" title="2">.  <span class="fl">12.755</span>   <span class="fl">0.886</span>   <span class="fl">2.661</span></a></code></pre></div>
<p>To compare an identical simulation done without parallelization</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(ans &lt;-<span class="st"> </span><span class="kw">mrgsim_d</span>(mod,data))</a></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">.    user  system elapsed </a>
<a class="sourceLine" id="cb11-2" title="2">.   <span class="fl">8.796</span>   <span class="fl">0.194</span>   <span class="fl">9.006</span></a></code></pre></div>
</div>
<div id="second-workflow-split-and-simulate-a-batch-of-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#second-workflow-split-and-simulate-a-batch-of-parameters" class="anchor"></a>Second workflow: split and simulate a batch of parameters</h2>
<p>Backend and the model</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="kw"><a href="https://rdrr.io/pkg/future/man/plan.html">plan</a></span>(multiprocess, <span class="dt">workers =</span> <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb12-2" title="2"></a>
<a class="sourceLine" id="cb12-3" title="3">mod &lt;-<span class="st"> </span><span class="kw">modlib</span>(<span class="st">"pk1cmt"</span>, <span class="dt">end =</span> <span class="dv">168</span><span class="op">*</span><span class="dv">4</span>, <span class="dt">delta =</span> <span class="dv">1</span>)</a></code></pre></div>
<p>For this workflow, we have a set of parameters (<code>idata</code>) along with an event object that gets applied to all of the parameters</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">idata &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="dt">CL =</span> <span class="kw"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="dv">4000</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>), <span class="dt">ID =</span> <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span>(CL))</a>
<a class="sourceLine" id="cb13-2" title="2"></a>
<a class="sourceLine" id="cb13-3" title="3"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(idata)</a></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">. <span class="co"># A tibble: 6 x 2</span></a>
<a class="sourceLine" id="cb14-2" title="2">.      CL    ID</a>
<a class="sourceLine" id="cb14-3" title="3">.   <span class="op">&lt;</span>dbl<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>int<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb14-4" title="4">. <span class="dv">1</span> <span class="fl">0.743</span>     <span class="dv">1</span></a>
<a class="sourceLine" id="cb14-5" title="5">. <span class="dv">2</span> <span class="fl">1.48</span>      <span class="dv">2</span></a>
<a class="sourceLine" id="cb14-6" title="6">. <span class="dv">3</span> <span class="fl">1.06</span>      <span class="dv">3</span></a>
<a class="sourceLine" id="cb14-7" title="7">. <span class="dv">4</span> <span class="fl">1.48</span>      <span class="dv">4</span></a>
<a class="sourceLine" id="cb14-8" title="8">. <span class="dv">5</span> <span class="fl">1.32</span>      <span class="dv">5</span></a>
<a class="sourceLine" id="cb14-9" title="9">. <span class="dv">6</span> <span class="fl">1.29</span>      <span class="dv">6</span></a></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">dose &lt;-<span class="st"> </span><span class="kw">ev</span>(<span class="dt">amt =</span> <span class="dv">100</span>, <span class="dt">ii =</span> <span class="dv">24</span>, <span class="dt">addl =</span> <span class="dv">27</span>)</a>
<a class="sourceLine" id="cb15-2" title="2"></a>
<a class="sourceLine" id="cb15-3" title="3">dose</a></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">. Events<span class="op">:</span></a>
<a class="sourceLine" id="cb16-2" title="2">.   time amt ii addl cmt evid</a>
<a class="sourceLine" id="cb16-3" title="3">. <span class="dv">1</span>    <span class="dv">0</span> <span class="dv">100</span> <span class="dv">24</span>   <span class="dv">27</span>   <span class="dv">1</span>    <span class="dv">1</span></a></code></pre></div>
<p>Run it in parallel</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(ans1 &lt;-<span class="st"> </span><span class="kw"><a href="reference/parallel_mrgsim_ei.html">mc_mrgsim_ei</a></span>(mod, dose, idata, <span class="dt">nchunk =</span> <span class="dv">6</span>))</a></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">.    user  system elapsed </a>
<a class="sourceLine" id="cb18-2" title="2">.   <span class="fl">8.494</span>   <span class="fl">0.911</span>   <span class="fl">1.913</span></a></code></pre></div>
<p>And without parallelization</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(ans2 &lt;-<span class="st"> </span><span class="kw">mrgsim_ei</span>(mod, dose, idata, <span class="dt">output=</span><span class="st">"df"</span>))</a></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1">.    user  system elapsed </a>
<a class="sourceLine" id="cb20-2" title="2">.   <span class="fl">5.971</span>   <span class="fl">0.172</span>   <span class="fl">6.169</span></a></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/identical.html">identical</a></span>(ans1,ans2)</a></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1">. [<span class="dv">1</span>] <span class="ot">TRUE</span></a></code></pre></div>
</div>
<div id="utility-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#utility-functions" class="anchor"></a>Utility functions</h2>
<p>You can access the chunking functions for your own parallel workflows</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1">dose &lt;-<span class="st"> </span><span class="kw">ev_seq</span>(<span class="kw">ev</span>(<span class="dt">amt =</span> <span class="dv">100</span>), <span class="kw">ev</span>(<span class="dt">amt =</span> <span class="dv">50</span>, <span class="dt">ii =</span> <span class="dv">12</span>, <span class="dt">addl =</span> <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb23-2" title="2">dose &lt;-<span class="st"> </span><span class="kw">ev_rep</span>(dose, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb23-3" title="3"></a>
<a class="sourceLine" id="cb23-4" title="4">dose</a></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1">.    time amt ii addl cmt evid ID</a>
<a class="sourceLine" id="cb24-2" title="2">. <span class="dv">1</span>     <span class="dv">0</span> <span class="dv">100</span>  <span class="dv">0</span>    <span class="dv">0</span>   <span class="dv">1</span>    <span class="dv">1</span>  <span class="dv">1</span></a>
<a class="sourceLine" id="cb24-3" title="3">. <span class="dv">2</span>     <span class="dv">0</span>  <span class="dv">50</span> <span class="dv">12</span>    <span class="dv">2</span>   <span class="dv">1</span>    <span class="dv">1</span>  <span class="dv">1</span></a>
<a class="sourceLine" id="cb24-4" title="4">. <span class="dv">3</span>     <span class="dv">0</span> <span class="dv">100</span>  <span class="dv">0</span>    <span class="dv">0</span>   <span class="dv">1</span>    <span class="dv">1</span>  <span class="dv">2</span></a>
<a class="sourceLine" id="cb24-5" title="5">. <span class="dv">4</span>     <span class="dv">0</span>  <span class="dv">50</span> <span class="dv">12</span>    <span class="dv">2</span>   <span class="dv">1</span>    <span class="dv">1</span>  <span class="dv">2</span></a>
<a class="sourceLine" id="cb24-6" title="6">. <span class="dv">5</span>     <span class="dv">0</span> <span class="dv">100</span>  <span class="dv">0</span>    <span class="dv">0</span>   <span class="dv">1</span>    <span class="dv">1</span>  <span class="dv">3</span></a>
<a class="sourceLine" id="cb24-7" title="7">. <span class="dv">6</span>     <span class="dv">0</span>  <span class="dv">50</span> <span class="dv">12</span>    <span class="dv">2</span>   <span class="dv">1</span>    <span class="dv">1</span>  <span class="dv">3</span></a>
<a class="sourceLine" id="cb24-8" title="8">. <span class="dv">7</span>     <span class="dv">0</span> <span class="dv">100</span>  <span class="dv">0</span>    <span class="dv">0</span>   <span class="dv">1</span>    <span class="dv">1</span>  <span class="dv">4</span></a>
<a class="sourceLine" id="cb24-9" title="9">. <span class="dv">8</span>     <span class="dv">0</span>  <span class="dv">50</span> <span class="dv">12</span>    <span class="dv">2</span>   <span class="dv">1</span>    <span class="dv">1</span>  <span class="dv">4</span></a>
<a class="sourceLine" id="cb24-10" title="10">. <span class="dv">9</span>     <span class="dv">0</span> <span class="dv">100</span>  <span class="dv">0</span>    <span class="dv">0</span>   <span class="dv">1</span>    <span class="dv">1</span>  <span class="dv">5</span></a>
<a class="sourceLine" id="cb24-11" title="11">. <span class="dv">10</span>    <span class="dv">0</span>  <span class="dv">50</span> <span class="dv">12</span>    <span class="dv">2</span>   <span class="dv">1</span>    <span class="dv">1</span>  <span class="dv">5</span></a></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1"><span class="kw"><a href="reference/chunk_data_frame.html">chunk_by_id</a></span>(dose, <span class="dt">nchunk =</span> <span class="dv">2</span>)</a></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" title="1">. <span class="op">$</span><span class="st">`</span><span class="dt">1</span><span class="st">`</span></a>
<a class="sourceLine" id="cb26-2" title="2">.   time amt ii addl cmt evid ID</a>
<a class="sourceLine" id="cb26-3" title="3">. <span class="dv">1</span>    <span class="dv">0</span> <span class="dv">100</span>  <span class="dv">0</span>    <span class="dv">0</span>   <span class="dv">1</span>    <span class="dv">1</span>  <span class="dv">1</span></a>
<a class="sourceLine" id="cb26-4" title="4">. <span class="dv">2</span>    <span class="dv">0</span>  <span class="dv">50</span> <span class="dv">12</span>    <span class="dv">2</span>   <span class="dv">1</span>    <span class="dv">1</span>  <span class="dv">1</span></a>
<a class="sourceLine" id="cb26-5" title="5">. <span class="dv">3</span>    <span class="dv">0</span> <span class="dv">100</span>  <span class="dv">0</span>    <span class="dv">0</span>   <span class="dv">1</span>    <span class="dv">1</span>  <span class="dv">2</span></a>
<a class="sourceLine" id="cb26-6" title="6">. <span class="dv">4</span>    <span class="dv">0</span>  <span class="dv">50</span> <span class="dv">12</span>    <span class="dv">2</span>   <span class="dv">1</span>    <span class="dv">1</span>  <span class="dv">2</span></a>
<a class="sourceLine" id="cb26-7" title="7">. <span class="dv">5</span>    <span class="dv">0</span> <span class="dv">100</span>  <span class="dv">0</span>    <span class="dv">0</span>   <span class="dv">1</span>    <span class="dv">1</span>  <span class="dv">3</span></a>
<a class="sourceLine" id="cb26-8" title="8">. <span class="dv">6</span>    <span class="dv">0</span>  <span class="dv">50</span> <span class="dv">12</span>    <span class="dv">2</span>   <span class="dv">1</span>    <span class="dv">1</span>  <span class="dv">3</span></a>
<a class="sourceLine" id="cb26-9" title="9">. </a>
<a class="sourceLine" id="cb26-10" title="10">. <span class="op">$</span><span class="st">`</span><span class="dt">2</span><span class="st">`</span></a>
<a class="sourceLine" id="cb26-11" title="11">.    time amt ii addl cmt evid ID</a>
<a class="sourceLine" id="cb26-12" title="12">. <span class="dv">7</span>     <span class="dv">0</span> <span class="dv">100</span>  <span class="dv">0</span>    <span class="dv">0</span>   <span class="dv">1</span>    <span class="dv">1</span>  <span class="dv">4</span></a>
<a class="sourceLine" id="cb26-13" title="13">. <span class="dv">8</span>     <span class="dv">0</span>  <span class="dv">50</span> <span class="dv">12</span>    <span class="dv">2</span>   <span class="dv">1</span>    <span class="dv">1</span>  <span class="dv">4</span></a>
<a class="sourceLine" id="cb26-14" title="14">. <span class="dv">9</span>     <span class="dv">0</span> <span class="dv">100</span>  <span class="dv">0</span>    <span class="dv">0</span>   <span class="dv">1</span>    <span class="dv">1</span>  <span class="dv">5</span></a>
<a class="sourceLine" id="cb26-15" title="15">. <span class="dv">10</span>    <span class="dv">0</span>  <span class="dv">50</span> <span class="dv">12</span>    <span class="dv">2</span>   <span class="dv">1</span>    <span class="dv">1</span>  <span class="dv">5</span></a></code></pre></div>
</div>
<div id="do-a-dry-run-to-check-the-overhead-of-parallelization" class="section level2">
<h2 class="hasAnchor">
<a href="#do-a-dry-run-to-check-the-overhead-of-parallelization" class="anchor"></a>Do a dry run to check the overhead of parallelization</h2>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1"><span class="kw"><a href="https://rdrr.io/pkg/future/man/plan.html">plan</a></span>(transparent)</a>
<a class="sourceLine" id="cb27-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(x &lt;-<span class="st"> </span><span class="kw"><a href="reference/parallel_mrgsim_d.html">fu_mrgsim_d</a></span>(mod,data,<span class="dt">.dry =</span> <span class="ot">TRUE</span>))</a></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" title="1">.    user  system elapsed </a>
<a class="sourceLine" id="cb28-2" title="2">.   <span class="fl">0.011</span>   <span class="fl">0.001</span>   <span class="fl">0.011</span></a></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1"><span class="kw"><a href="https://rdrr.io/pkg/future/man/plan.html">plan</a></span>(multiprocess,<span class="dt">workers =</span> 8L)</a>
<a class="sourceLine" id="cb29-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(x &lt;-<span class="st"> </span><span class="kw"><a href="reference/parallel_mrgsim_d.html">fu_mrgsim_d</a></span>(mod,data,<span class="dt">nchunk =</span> <span class="dv">8</span>, <span class="dt">.dry =</span> <span class="ot">TRUE</span>))</a></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" title="1">.    user  system elapsed </a>
<a class="sourceLine" id="cb30-2" title="2">.   <span class="fl">0.123</span>   <span class="fl">0.183</span>   <span class="fl">0.148</span></a></code></pre></div>
</div>
<div id="pass-a-function-to-post-process-on-the-worker" class="section level2">
<h2 class="hasAnchor">
<a href="#pass-a-function-to-post-process-on-the-worker" class="anchor"></a>Pass a function to post process on the worker</h2>
<p>First check the range of times from the previous example</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(ans1<span class="op">$</span>time)</a></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" title="1">.    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </a>
<a class="sourceLine" id="cb32-2" title="2">.     <span class="fl">0.0</span>   <span class="fl">167.0</span>   <span class="fl">335.5</span>   <span class="fl">335.5</span>   <span class="fl">504.0</span>   <span class="fl">672.0</span></a></code></pre></div>
<p>The post-processing function has arguments the simulated data and the model object</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" title="1">post &lt;-<span class="st"> </span><span class="cf">function</span>(sims, mod) {</a>
<a class="sourceLine" id="cb33-2" title="2">  <span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(sims, time <span class="op">&gt;</span><span class="st"> </span><span class="dv">600</span>)  </a>
<a class="sourceLine" id="cb33-3" title="3">}</a>
<a class="sourceLine" id="cb33-4" title="4"></a>
<a class="sourceLine" id="cb33-5" title="5">dose &lt;-<span class="st"> </span><span class="kw">ev</span>(<span class="dt">amt =</span> <span class="dv">100</span>, <span class="dt">ii =</span> <span class="dv">24</span>, <span class="dt">addl =</span> <span class="dv">27</span>)</a>
<a class="sourceLine" id="cb33-6" title="6"></a>
<a class="sourceLine" id="cb33-7" title="7">ans3 &lt;-<span class="st"> </span><span class="kw"><a href="reference/parallel_mrgsim_ei.html">mc_mrgsim_ei</a></span>(mod, dose, idata, <span class="dt">nchunk =</span> <span class="dv">6</span>, <span class="dt">.p =</span> post)</a></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(ans3<span class="op">$</span>time)</a></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" title="1">.    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </a>
<a class="sourceLine" id="cb35-2" title="2">.   <span class="fl">601.0</span>   <span class="fl">618.8</span>   <span class="fl">636.5</span>   <span class="fl">636.5</span>   <span class="fl">654.2</span>   <span class="fl">672.0</span></a></code></pre></div>
<p>The main use case here is to summarize or some how decrease the volume of data before returning the combined simulations. In case memory is able to handle the simulation volume, this post-processing could be done on the combined data as well.</p>
<p>See also: <code>chunk_by_row</code></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/mrgsolve/mrgsolve.fu">https://​github.com/​mrgsolve/​mrgsolve.fu</a>
</li>
<li>Report a bug at <br><a href="https://github.com/mrgsolve/mrgsolve.fu/issues">https://​github.com/​mrgsolve/​mrgsolve.fu/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>GPL (&gt;=2)</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Kyle Baron <br><small class="roles"> Maintainer </small>  </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/mrgsolve/mrgsolve.fu"><img src="https://travis-ci.org/mrgsolve/mrgsolve.fu.svg?branch=master" alt="Travis build status"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Kyle Baron.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.0.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
