<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulate with mrgsolve in Parallel • mrgsim.parallel</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Simulate with mrgsolve in Parallel">
<meta property="og:description" content="Simulation from an mrgsolve 
    &lt;https://cran.r-project.org/package=mrgsolve&gt; model using a parallel backend.  
    Input data sets are split (chunked) and simulated in parallel using 
    mclapply() or future_lapply() 
    &lt;https://cran.r-project.org/package=future.apply&gt;.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">mrgsim.parallel</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/file-stream.html">File Stream Workflow</a>
    </li>
    <li>
      <a href="articles/mrgsim.parallel.html">Get started</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kylebaron/mrgsim.parallel/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="mrgsimparallel">mrgsim.parallel<a class="anchor" aria-label="anchor" href="#mrgsimparallel"></a>
</h1></div>
<!-- badges: start -->
<!-- badges: end -->
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>mrgsolve.parallel facilitates parallel simulation with mrgsolve in R. The future and parallel packages provide the parallelization.</p>
<p>There are 2 main workflows:</p>
<ol style="list-style-type: decimal">
<li>Split a <code>data_set</code> into chunks by ID, simulate the chunks in parallel, then assemble the results back to a single data frame.</li>
<li>Split an <code>idata_set</code> (individual-level parameters) into chunks by row, simulate the chunks in parallel, then assemble the results back to a single data frame.</li>
</ol>
<p>The nature of the parallel backend requires some overhead to get the parallel simulation done. So, it will take a reasonably-sized job to see a speed increase and small jobs will likely take <em>longer</em> with parallelization. But jobs taking more than a handful of seconds could benefit from this type of parallelization.</p>
</div>
<div class="section level2">
<h2 id="backend">Backend<a class="anchor" aria-label="anchor" href="#backend"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/kylebaron/mrgsim.parallel" class="external-link">mrgsim.parallel</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>future.fork.enable <span class="op">=</span> <span class="cn">TRUE</span>, parallelly.fork.enable <span class="op">=</span> <span class="cn">TRUE</span>, mc.cores <span class="op">=</span> <span class="fl">4L</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="first-workflow-split-and-simulate-a-data-set">First workflow: split and simulate a data set<a class="anchor" aria-label="anchor" href="#first-workflow-split-and-simulate-a-data-set"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mrgsolve/man/modlib.html" class="external-link">modlib</a></span><span class="op">(</span><span class="st">"pk2cmt"</span>, end <span class="op">=</span> <span class="fl">168</span><span class="op">*</span><span class="fl">8</span>, delta <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mrgsolve/man/expand.idata.html" class="external-link">expand.ev</a></span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">100</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2000</span><span class="op">)</span>, ii <span class="op">=</span> <span class="fl">24</span>, addl <span class="op">=</span> <span class="fl">27</span><span class="op">*</span><span class="fl">2</span><span class="op">+</span><span class="fl">2</span><span class="op">)</span> 

<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">data</span>, CL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">0.7</span>, <span class="fl">1.3</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>.   ID time amt ii addl cmt evid        CL</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>. <span class="dv">1</span>  <span class="dv">1</span>    <span class="dv">0</span> <span class="dv">100</span> <span class="dv">24</span>   <span class="dv">56</span>   <span class="dv">1</span>    <span class="dv">1</span> <span class="fl">0.9714138</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>. <span class="dv">2</span>  <span class="dv">2</span>    <span class="dv">0</span> <span class="dv">200</span> <span class="dv">24</span>   <span class="dv">56</span>   <span class="dv">1</span>    <span class="dv">1</span> <span class="fl">0.7977687</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>. <span class="dv">3</span>  <span class="dv">3</span>    <span class="dv">0</span> <span class="dv">300</span> <span class="dv">24</span>   <span class="dv">56</span>   <span class="dv">1</span>    <span class="dv">1</span> <span class="fl">0.7937479</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>. <span class="dv">4</span>  <span class="dv">4</span>    <span class="dv">0</span> <span class="dv">400</span> <span class="dv">24</span>   <span class="dv">56</span>   <span class="dv">1</span>    <span class="dv">1</span> <span class="fl">1.0287696</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>. <span class="dv">5</span>  <span class="dv">5</span>    <span class="dv">0</span> <span class="dv">500</span> <span class="dv">24</span>   <span class="dv">56</span>   <span class="dv">1</span>    <span class="dv">1</span> <span class="fl">1.1802787</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>. <span class="dv">6</span>  <span class="dv">6</span>    <span class="dv">0</span> <span class="dv">600</span> <span class="dv">24</span>   <span class="dv">56</span>   <span class="dv">1</span>    <span class="dv">1</span> <span class="fl">0.7458695</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>. [<span class="dv">1</span>] <span class="dv">2000</span>    <span class="dv">8</span></span></code></pre></div>
<p>We can simulate in parallel with the future package or the parallel package like this:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">4L</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">ans1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/parallel_mrgsim_d.html">future_mrgsim_d</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">data</span>, nchunk <span class="op">=</span> <span class="fl">4L</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>.    user  system elapsed </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>.   <span class="fl">0.473</span>   <span class="fl">0.176</span>   <span class="fl">4.173</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multicore</span>, workers <span class="op">=</span> <span class="fl">4L</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">ans1b</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/parallel_mrgsim_d.html">future_mrgsim_d</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">data</span>, nchunk <span class="op">=</span> <span class="fl">4L</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>.    user  system elapsed </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>.   <span class="fl">5.322</span>   <span class="fl">0.544</span>   <span class="fl">1.846</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">ans2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/parallel_mrgsim_d.html">mc_mrgsim_d</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">data</span>, nchunk <span class="op">=</span> <span class="fl">4L</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>.    user  system elapsed </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>.   <span class="fl">5.289</span>   <span class="fl">0.563</span>   <span class="fl">1.756</span></span></code></pre></div>
<p>To compare an identical simulation done without parallelization</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">ans3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mrgsolve/man/mrgsim_variants.html" class="external-link">mrgsim_d</a></span><span class="op">(</span><span class="va">mod</span>,<span class="va">data</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>.    user  system elapsed </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>.   <span class="fl">4.839</span>   <span class="fl">0.105</span>   <span class="fl">4.954</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">ans2</span>,<span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">ans3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>. [<span class="dv">1</span>] <span class="cn">TRUE</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="second-workflow-split-and-simulate-a-batch-of-parameters">Second workflow: split and simulate a batch of parameters<a class="anchor" aria-label="anchor" href="#second-workflow-split-and-simulate-a-batch-of-parameters"></a>
</h2>
<p>Backend and the model</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>

<span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mrgsolve/man/modlib.html" class="external-link">modlib</a></span><span class="op">(</span><span class="st">"pk1cmt"</span>, end <span class="op">=</span> <span class="fl">168</span><span class="op">*</span><span class="fl">4</span>, delta <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>For this workflow, we have a set of parameters (<code>idata</code>) along with an event object that gets applied to all of the parameters</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">idata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>CL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">4000</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span><span class="op">)</span>, ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">CL</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">idata</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>. <span class="co"># A tibble: 6 × 2</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>.      CL    ID</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>.   <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>int<span class="sc">&gt;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>. <span class="dv">1</span> <span class="fl">0.552</span>     <span class="dv">1</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>. <span class="dv">2</span> <span class="fl">0.765</span>     <span class="dv">2</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>. <span class="dv">3</span> <span class="fl">0.669</span>     <span class="dv">3</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>. <span class="dv">4</span> <span class="fl">0.943</span>     <span class="dv">4</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>. <span class="dv">5</span> <span class="fl">0.929</span>     <span class="dv">5</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>. <span class="dv">6</span> <span class="fl">1.19</span>      <span class="dv">6</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dose</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mrgsolve/man/ev.html" class="external-link">ev</a></span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">100</span>, ii <span class="op">=</span> <span class="fl">24</span>, addl <span class="op">=</span> <span class="fl">27</span><span class="op">)</span>

<span class="va">dose</span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>. Events<span class="sc">:</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>.   time amt ii addl cmt evid</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>. <span class="dv">1</span>    <span class="dv">0</span> <span class="dv">100</span> <span class="dv">24</span>   <span class="dv">27</span>   <span class="dv">1</span>    <span class="dv">1</span></span></code></pre></div>
<p>Run it in parallel</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">ans1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/parallel_mrgsim_ei.html">mc_mrgsim_ei</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">dose</span>, <span class="va">idata</span>, nchunk <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>.    user  system elapsed </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>.   <span class="fl">3.705</span>   <span class="fl">0.481</span>   <span class="fl">1.486</span></span></code></pre></div>
<p>And without parallelization</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">ans2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mrgsolve/man/mrgsim_variants.html" class="external-link">mrgsim_ei</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">dose</span>, <span class="va">idata</span>, output <span class="op">=</span> <span class="st">"df"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>.    user  system elapsed </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>.   <span class="fl">3.313</span>   <span class="fl">0.076</span>   <span class="fl">3.395</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">ans1</span>,<span class="va">ans2</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>. [<span class="dv">1</span>] <span class="cn">TRUE</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="utility-functions">Utility functions<a class="anchor" aria-label="anchor" href="#utility-functions"></a>
</h2>
<p>You can access the chunking functions for your own parallel workflows</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dose</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mrgsolve/man/ev_seq.html" class="external-link">ev_seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/mrgsolve/man/ev.html" class="external-link">ev</a></span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/mrgsolve/man/ev.html" class="external-link">ev</a></span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">50</span>, ii <span class="op">=</span> <span class="fl">12</span>, addl <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">dose</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mrgsolve/man/ev_rep.html" class="external-link">ev_rep</a></span><span class="op">(</span><span class="va">dose</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>

<span class="va">dose</span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>.    ID time amt ii addl cmt evid</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>. <span class="dv">1</span>   <span class="dv">1</span>    <span class="dv">0</span> <span class="dv">100</span>  <span class="dv">0</span>    <span class="dv">0</span>   <span class="dv">1</span>    <span class="dv">1</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>. <span class="dv">2</span>   <span class="dv">1</span>    <span class="dv">0</span>  <span class="dv">50</span> <span class="dv">12</span>    <span class="dv">2</span>   <span class="dv">1</span>    <span class="dv">1</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>. <span class="dv">3</span>   <span class="dv">2</span>    <span class="dv">0</span> <span class="dv">100</span>  <span class="dv">0</span>    <span class="dv">0</span>   <span class="dv">1</span>    <span class="dv">1</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>. <span class="dv">4</span>   <span class="dv">2</span>    <span class="dv">0</span>  <span class="dv">50</span> <span class="dv">12</span>    <span class="dv">2</span>   <span class="dv">1</span>    <span class="dv">1</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>. <span class="dv">5</span>   <span class="dv">3</span>    <span class="dv">0</span> <span class="dv">100</span>  <span class="dv">0</span>    <span class="dv">0</span>   <span class="dv">1</span>    <span class="dv">1</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>. <span class="dv">6</span>   <span class="dv">3</span>    <span class="dv">0</span>  <span class="dv">50</span> <span class="dv">12</span>    <span class="dv">2</span>   <span class="dv">1</span>    <span class="dv">1</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>. <span class="dv">7</span>   <span class="dv">4</span>    <span class="dv">0</span> <span class="dv">100</span>  <span class="dv">0</span>    <span class="dv">0</span>   <span class="dv">1</span>    <span class="dv">1</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>. <span class="dv">8</span>   <span class="dv">4</span>    <span class="dv">0</span>  <span class="dv">50</span> <span class="dv">12</span>    <span class="dv">2</span>   <span class="dv">1</span>    <span class="dv">1</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>. <span class="dv">9</span>   <span class="dv">5</span>    <span class="dv">0</span> <span class="dv">100</span>  <span class="dv">0</span>    <span class="dv">0</span>   <span class="dv">1</span>    <span class="dv">1</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>. <span class="dv">10</span>  <span class="dv">5</span>    <span class="dv">0</span>  <span class="dv">50</span> <span class="dv">12</span>    <span class="dv">2</span>   <span class="dv">1</span>    <span class="dv">1</span></span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/chunk_data_frame.html">chunk_by_id</a></span><span class="op">(</span><span class="va">dose</span>, nchunk <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>. <span class="sc">$</span><span class="st">`</span><span class="at">1</span><span class="st">`</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>.   ID time amt ii addl cmt evid</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>. <span class="dv">1</span>  <span class="dv">1</span>    <span class="dv">0</span> <span class="dv">100</span>  <span class="dv">0</span>    <span class="dv">0</span>   <span class="dv">1</span>    <span class="dv">1</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>. <span class="dv">2</span>  <span class="dv">1</span>    <span class="dv">0</span>  <span class="dv">50</span> <span class="dv">12</span>    <span class="dv">2</span>   <span class="dv">1</span>    <span class="dv">1</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>. <span class="dv">3</span>  <span class="dv">2</span>    <span class="dv">0</span> <span class="dv">100</span>  <span class="dv">0</span>    <span class="dv">0</span>   <span class="dv">1</span>    <span class="dv">1</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>. <span class="dv">4</span>  <span class="dv">2</span>    <span class="dv">0</span>  <span class="dv">50</span> <span class="dv">12</span>    <span class="dv">2</span>   <span class="dv">1</span>    <span class="dv">1</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>. <span class="dv">5</span>  <span class="dv">3</span>    <span class="dv">0</span> <span class="dv">100</span>  <span class="dv">0</span>    <span class="dv">0</span>   <span class="dv">1</span>    <span class="dv">1</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>. <span class="dv">6</span>  <span class="dv">3</span>    <span class="dv">0</span>  <span class="dv">50</span> <span class="dv">12</span>    <span class="dv">2</span>   <span class="dv">1</span>    <span class="dv">1</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>. </span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>. <span class="sc">$</span><span class="st">`</span><span class="at">2</span><span class="st">`</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>.    ID time amt ii addl cmt evid</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>. <span class="dv">7</span>   <span class="dv">4</span>    <span class="dv">0</span> <span class="dv">100</span>  <span class="dv">0</span>    <span class="dv">0</span>   <span class="dv">1</span>    <span class="dv">1</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>. <span class="dv">8</span>   <span class="dv">4</span>    <span class="dv">0</span>  <span class="dv">50</span> <span class="dv">12</span>    <span class="dv">2</span>   <span class="dv">1</span>    <span class="dv">1</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>. <span class="dv">9</span>   <span class="dv">5</span>    <span class="dv">0</span> <span class="dv">100</span>  <span class="dv">0</span>    <span class="dv">0</span>   <span class="dv">1</span>    <span class="dv">1</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>. <span class="dv">10</span>  <span class="dv">5</span>    <span class="dv">0</span>  <span class="dv">50</span> <span class="dv">12</span>    <span class="dv">2</span>   <span class="dv">1</span>    <span class="dv">1</span></span></code></pre></div>
<p>See also: <code>chunk_by_row</code></p>
</div>
<div class="section level2">
<h2 id="do-a-dry-run-to-check-the-overhead-of-parallelization">Do a dry run to check the overhead of parallelization<a class="anchor" aria-label="anchor" href="#do-a-dry-run-to-check-the-overhead-of-parallelization"></a>
</h2>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">transparent</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/parallel_mrgsim_d.html">fu_mrgsim_d</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">data</span>, nchunk <span class="op">=</span> <span class="fl">8</span>, .dry <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>.    user  system elapsed </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>.   <span class="fl">0.014</span>   <span class="fl">0.001</span>   <span class="fl">0.016</span></span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">8L</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/parallel_mrgsim_d.html">fu_mrgsim_d</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">data</span>, nchunk <span class="op">=</span> <span class="fl">8</span>, .dry <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>.    user  system elapsed </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>.   <span class="fl">0.045</span>   <span class="fl">0.003</span>   <span class="fl">5.151</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="pass-a-function-to-post-process-on-the-worker">Pass a function to post process on the worker<a class="anchor" aria-label="anchor" href="#pass-a-function-to-post-process-on-the-worker"></a>
</h2>
<p>First check the range of times from the previous example</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ans1</span><span class="op">$</span><span class="va">time</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>.    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>.     <span class="fl">0.0</span>   <span class="fl">167.0</span>   <span class="fl">335.5</span>   <span class="fl">335.5</span>   <span class="fl">504.0</span>   <span class="fl">672.0</span></span></code></pre></div>
<p>The post-processing function has arguments the simulated data and the model object</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">post</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sims</span>, <span class="va">mod</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sims</span>, <span class="va">time</span> <span class="op">&gt;</span> <span class="fl">600</span><span class="op">)</span>  
<span class="op">}</span>

<span class="va">dose</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mrgsolve/man/ev.html" class="external-link">ev</a></span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">100</span>, ii <span class="op">=</span> <span class="fl">24</span>, addl <span class="op">=</span> <span class="fl">27</span><span class="op">)</span>

<span class="va">ans3</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/parallel_mrgsim_ei.html">mc_mrgsim_ei</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">dose</span>, <span class="va">idata</span>, nchunk <span class="op">=</span> <span class="fl">6</span>, .p <span class="op">=</span> <span class="va">post</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ans3</span><span class="op">$</span><span class="va">time</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb39"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>.    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>.   <span class="fl">601.0</span>   <span class="fl">618.8</span>   <span class="fl">636.5</span>   <span class="fl">636.5</span>   <span class="fl">654.2</span>   <span class="fl">672.0</span></span></code></pre></div>
<p>The main use case here is to summarize or some how decrease the volume of data before returning the combined simulations. In case memory is able to handle the simulation volume, this post-processing could be done on the combined data as well.</p>
<hr>
</div>
<div class="section level2">
<h2 id="more-info">More info<a class="anchor" aria-label="anchor" href="#more-info"></a>
</h2>
<p>See <a href="inst/docs/stories.html">inst/docs/stories.md (on GitHub only)</a> for more details.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=mrgsim.parallel" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/kylebaron/mrgsim.parallel/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/kylebaron/mrgsim.parallel/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>GPL (&gt;=2)</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing mrgsim.parallel</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Kyle Baron <br><small class="roles"> Maintainer </small>  </li>
</ul>
</div>



  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Kyle Baron.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
